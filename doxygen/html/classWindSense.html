<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>NEWMAST: WindSense Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">NEWMAST
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">WindSense Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="WindSense" --><table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><b>GPGLL</b></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">GPS Data Struct Contains the GPS data from the airmar. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><b>GPVTG</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><b>WIMWV</b></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWindSense.html#af664d8ea5db527206e64301455277929">WindSense</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWindSense.html#a41186075f501fbc3b9c691e215c4ec47">debug</a> (<a class="el" href="classHardwareSerial.html">HardwareSerial</a> &amp;debugPortIn)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Stuff related purely to out wind sensor set-up.  <a href="#a41186075f501fbc3b9c691e215c4ec47"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWindSense.html#aa68e74aa80256710f68238196f4d5fd0">debugDump</a> (<a class="el" href="classHardwareSerial.html">HardwareSerial</a> &amp;debugPortIn)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Dumps a lot of info to the computers serial line.  <a href="#aa68e74aa80256710f68238196f4d5fd0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab7f27184b3f70ddabb19ebc299b7e79e"></a><!-- doxytag: member="WindSense::betterDebug" ref="ab7f27184b3f70ddabb19ebc299b7e79e" args="(HardwareSerial &amp;debugPortIn)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWindSense.html#ab7f27184b3f70ddabb19ebc299b7e79e">betterDebug</a> (<a class="el" href="classHardwareSerial.html">HardwareSerial</a> &amp;debugPortIn)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempt to create a more brief debug output Uses the sprintf to generate a single string to be dealt with by the serial function, rather than having to call it all the time. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWindSense.html#aa85692bc66f9f6d635e81590a0782a45">pollAllValues</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">All of the functions visible to the user.  <a href="#aa85692bc66f9f6d635e81590a0782a45"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a622dd679c41dd169ff9ed4286c170fff"></a><!-- doxytag: member="WindSense::pollValue" ref="a622dd679c41dd169ff9ed4286c170fff" args="(char nmea)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>pollValue</b> (char nmea)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa65c5726c560c19369894c401e82c280"></a><!-- doxytag: member="WindSense::attach" ref="aa65c5726c560c19369894c401e82c280" args="(HardwareSerial &amp;sensorPort)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>attach</b> (<a class="el" href="classHardwareSerial.html">HardwareSerial</a> &amp;sensorPort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4eb80a839c1856caac3f8303bb7362e6"></a><!-- doxytag: member="WindSense::stupidDebug" ref="a4eb80a839c1856caac3f8303bb7362e6" args="()" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>stupidDebug</b> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="WindSense_8h_source.html#l00020">20</a> of file <a class="el" href="WindSense_8h_source.html">WindSense.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="af664d8ea5db527206e64301455277929"></a><!-- doxytag: member="WindSense::WindSense" ref="af664d8ea5db527206e64301455277929" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WindSense::WindSense </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>&lt; index for partSentence</p>
<p>&lt; index for the array of strings </p>

<p>Definition at line <a class="el" href="WindSense_8cpp_source.html#l00003">3</a> of file <a class="el" href="WindSense_8cpp_source.html">WindSense.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                     {
    partCount = 0;        
    stringArrayIdx = 0;   
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a41186075f501fbc3b9c691e215c4ec47"></a><!-- doxytag: member="WindSense::debug" ref="a41186075f501fbc3b9c691e215c4ec47" args="(HardwareSerial &amp;debugPortIn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WindSense::debug </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classHardwareSerial.html">HardwareSerial</a> &amp;&#160;</td>
          <td class="paramname"><em>debugPortIn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stuff related purely to out wind sensor set-up. </p>
<p>Things like the initialization after instantiation of the object, and some debugging function stuff. Waits for NMEA, tells you everything</p>
<p>This function takes a serial port to use for debugging the functions and listens for an NMEA sentence. Then it runs through them with the validation, splitting and parsing functions. It spits out output the entire way.</p>
<p>For this function to work properly, it must be called within a loop. If this were the only line to be executed in the main loop, it would work as expected.</p>
<p>The Serial port given to this function must have already had the baud rate set </p>

<p>Definition at line <a class="el" href="AIRMARSpecific_8cpp_source.html#l00022">22</a> of file <a class="el" href="AIRMARSpecific_8cpp_source.html">AIRMARSpecific.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                {
    debugPort = &amp;debugPortIn;

    <span class="keywordflow">while</span>(senSerial-&gt;available()) {
        <span class="keywordflow">if</span> (senSerial-&gt;available() &gt; MAX_SERIAL_BUFFER) {
            senSerial-&gt;flush();
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (grabChar(senSerial-&gt;read())) {
            <span class="comment">//betterDebug(debugPortIn);</span>
            <a class="code" href="classWindSense.html#aa68e74aa80256710f68238196f4d5fd0" title="Dumps a lot of info to the computers serial line.">debugDump</a>(debugPortIn);
        }
    }

    <span class="keywordflow">return</span> 1;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classWindSense_a41186075f501fbc3b9c691e215c4ec47_cgraph.png" border="0" usemap="#classWindSense_a41186075f501fbc3b9c691e215c4ec47_cgraph" alt=""/></div>
<map name="classWindSense_a41186075f501fbc3b9c691e215c4ec47_cgraph" id="classWindSense_a41186075f501fbc3b9c691e215c4ec47_cgraph">
<area shape="rect" id="node3" href="classWindSense.html#aa68e74aa80256710f68238196f4d5fd0" title="Dumps a lot of info to the computers serial line." alt="" coords="190,5,359,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa68e74aa80256710f68238196f4d5fd0"></a><!-- doxytag: member="WindSense::debugDump" ref="aa68e74aa80256710f68238196f4d5fd0" args="(HardwareSerial &amp;debugPortIn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WindSense::debugDump </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classHardwareSerial.html">HardwareSerial</a> &amp;&#160;</td>
          <td class="paramname"><em>debugPortIn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Dumps a lot of info to the computers serial line. </p>
<p>Would have been incorporated directly into the debug function, but it just takes up too much space. In the event the flash image for the arduino becomes too large be sure to get rid of this function.</p>
<p>Resets the Internal NMEA Index counters </p>

<p>Definition at line <a class="el" href="AIRMARSpecific_8cpp_source.html#l00046">46</a> of file <a class="el" href="AIRMARSpecific_8cpp_source.html">AIRMARSpecific.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                    {
    <a class="code" href="classHardwareSerial.html">HardwareSerial</a>* debugPort = &amp;debugPortIn;

    <span class="comment">// Information about what is in the partSentence Buffer</span>
    debugPort-&gt;println(<span class="stringliteral">&quot;NMEA Detected&quot;</span>);
    debugPort-&gt;println(partSentence);
    debugPort-&gt;print(<span class="stringliteral">&quot;Valid?...&quot;</span>);
    debugPort-&gt;println(validateInternalNMEA());

    <span class="comment">// Separating the NMEA into sub-strings</span>
    splitInternalNMEA();
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; stringArrayIdx; i++) {
        debugPort-&gt;print(<span class="stringliteral">&quot;String &quot;</span>);
        debugPort-&gt;print(i);
        debugPort-&gt;print(<span class="stringliteral">&quot; &quot;</span>);
        debugPort-&gt;println(stringArray[i]);
    }

    parseInternalNMEA(stringArray[0]);

    <span class="comment">// Dump the degrees and minutes to see if it worked</span>
    debugPort-&gt;print(<span class="stringliteral">&quot;The minutes lattitude are &quot;</span>);
    debugPort-&gt;println(GPS_GPGLL.minuteLatitude);
    debugPort-&gt;print(<span class="stringliteral">&quot;The degrees lattitude are &quot;</span>);
    debugPort-&gt;println(GPS_GPGLL.degreeLatitude);
    debugPort-&gt;print(<span class="stringliteral">&quot;Lattitude Direction is &quot;</span>);
    debugPort-&gt;println(GPS_GPGLL.latitudeDirection);

    debugPort-&gt;print(<span class="stringliteral">&quot;The minutes longitude are &quot;</span>);
    debugPort-&gt;println(GPS_GPGLL.minuteLongitude);
    debugPort-&gt;print(<span class="stringliteral">&quot;The degrees longitude are &quot;</span>);
    debugPort-&gt;println(GPS_GPGLL.degreeLongitude);
    debugPort-&gt;print(<span class="stringliteral">&quot;longitude Direction is &quot;</span>);
    debugPort-&gt;println(GPS_GPGLL.longitudeDirection);

    debugPort-&gt;print(<span class="stringliteral">&quot;Wind Speed is &quot;</span>);
    debugPort-&gt;println(WIND_WIMWV.windSpeed);
    debugPort-&gt;print(<span class="stringliteral">&quot;Units for the speed &quot;</span>);
    debugPort-&gt;println(WIND_WIMWV.windSpeedUnits);
    debugPort-&gt;print(<span class="stringliteral">&quot;The angle is &quot;</span>);
    debugPort-&gt;println(WIND_WIMWV.windAngle);
    debugPort-&gt;print(<span class="stringliteral">&quot;The reference for that angle &quot;</span>);
    debugPort-&gt;println(WIND_WIMWV.reference);

    debugPort-&gt;print(<span class="stringliteral">&quot;Speed over ground &quot;</span>);
    debugPort-&gt;println(SPEED_GPVTG.speedoverGround);
    debugPort-&gt;print(<span class="stringliteral">&quot;Units &quot;</span>);
    debugPort-&gt;println(SPEED_GPVTG.speedUnits);
    debugPort-&gt;print(<span class="stringliteral">&quot;Course over ground &quot;</span>);
    debugPort-&gt;println(SPEED_GPVTG.courseoverGround);
    debugPort-&gt;print(<span class="stringliteral">&quot;Units &quot;</span>);
    debugPort-&gt;println(SPEED_GPVTG.unitCourseMeasurement);

    resetInternalNMEA();
    <span class="keywordflow">return</span> 1;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa85692bc66f9f6d635e81590a0782a45"></a><!-- doxytag: member="WindSense::pollAllValues" ref="aa85692bc66f9f6d635e81590a0782a45" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int WindSense::pollAllValues </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>All of the functions visible to the user. </p>
<p><a class="el" href="PublicFunctions_8cpp_source.html">PublicFunctions.cpp</a></p>
<p>Created on: Dec 2, 2011 Author: allgood38 Wait until all the possible values from the wind sensor updated</p>
<p>Within the maximum amount of time, wait for enough serial data to parse all of the known values from the wind sensor.</p>
<p>After every valid sentence </p>

<p>Definition at line <a class="el" href="PublicFunctions_8cpp_source.html#l00016">16</a> of file <a class="el" href="PublicFunctions_8cpp_source.html">PublicFunctions.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                             {
    <span class="keyword">const</span> <span class="keywordtype">int</span> recentlyUpdatedTime = 500;
    <span class="keywordtype">int</span> timeStart = millis() - 10;
    <span class="keywordtype">int</span> timeElapsed = millis() - timeStart;

    <span class="keywordtype">bool</span> GPGLL_Updated = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> WIMWV_Updated = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> GPVTG_Updated = <span class="keyword">false</span>;
    <span class="keywordtype">bool</span> successfullParse = <span class="keyword">false</span>;

    <span class="keywordtype">char</span>* lastUpdated = <span class="charliteral">&#39;\0&#39;</span>;

    <span class="keywordflow">while</span> (!GPGLL_Updated || !WIMWV_Updated || !GPVTG_Updated) {

        <span class="keywordflow">if</span> (senSerial-&gt;available() &gt; MAX_SERIAL_BUFFER) {
            senSerial-&gt;flush();
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (senSerial-&gt;available() &amp;&amp; grabChar(senSerial-&gt;read())) {
            successfullParse = !(bool)processInternalNMEA();
        }

        <span class="comment">/* Check to see which structure was just updated</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (successfullParse) {
            <span class="keywordflow">if</span> (GPS_GPGLL.lastUpdated &gt; millis() - recentlyUpdatedTime) {
                GPGLL_Updated = <span class="keyword">true</span>;
            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (WIND_WIMWV.lastUpdated &gt; millis() - recentlyUpdatedTime) {
                WIMWV_Updated = <span class="keyword">true</span>;
            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SPEED_GPVTG.lastUpdated &gt; millis() - recentlyUpdatedTime) {
                GPVTG_Updated = <span class="keyword">true</span>;
            }
            successfullParse = <span class="keyword">false</span>;
        }

        <span class="comment">/* Further Conditions on the loop,</span>
<span class="comment">         * if too much time has passed, abort */</span>
        timeElapsed = millis() - timeStart;
        <span class="keywordflow">if</span> (timeElapsed &gt; MAX_POLL_TIME_MS) {
            <span class="keywordflow">return</span> 1;
        }
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="WindSense_8h_source.html">WindSense.h</a></li>
<li><a class="el" href="AIRMARSpecific_8cpp_source.html">AIRMARSpecific.cpp</a></li>
<li><a class="el" href="ParseToStruct_8cpp_source.html">ParseToStruct.cpp</a></li>
<li><a class="el" href="PublicFunctions_8cpp_source.html">PublicFunctions.cpp</a></li>
<li><a class="el" href="WindSense_8cpp_source.html">WindSense.cpp</a></li>
</ul>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sat Dec 3 2011 18:11:19 for NEWMAST by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
